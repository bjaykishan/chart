{{ if .Values.license }}
{{ if .Values.communitymanager.install }}
{{ if .Values.communitymanager.prod.enable }}
kind: ConfigMap
apiVersion: v1
metadata:
  name: {{ .Release.Name }}-prodpcm-setupfile
  labels: {{- include "prodpcm-pod.labels" . | nindent 5 }}
data:
  application.yml: |-

    accept-licence: {{ .Values.communitymanager.prod.setupfile.acceptLicence }}
    cm:
      color: {{ .Values.communitymanager.prod.setupfile.cm.color }}
      cmks: ${APPLICATION_PASSPHRASE}
    server:
      port:
      ssl:
        enabled: true
        key-store: /opt/IBM/config/security/pcm-keystore.p12
        key-store-password: ${SERVER_KEYSTORE_PASSWORD}
        key-store-type: PKCS12
      serverHeader: IBM Partner Engagement Manager Community Manager
      compression:
        enabled: true
        min-response-size: 1024
      ajp:
        enabled: false
        port: 8585
    spring:
      jackson:
        time-zone: {{ .Values.communitymanager.prod.setupfile.time_zone }}
      liquibase:
        enabled: true
        liquibase-tablespace:
      datasource:
        type: com.zaxxer.hikari.HikariDataSource
        url: {{ .Values.communitymanager.prod.setupfile.spring.datasource.url }}
        username: {{ .Values.communitymanager.prod.setupfile.spring.datasource.username }}
        driver-class-name: {{ .Values.communitymanager.prod.setupfile.spring.datasource.driver_class_name }}
        hikari:
          connection-timeout: 60000
          maximum-pool-size: 60
          auto-commit: false
        ssl:
          enabled: {{ .Values.communitymanager.prod.setupfile.spring.datasource.ssl.enabled }}
          trust-store: /opt/IBM/config/security/{{ .Values.communitymanager.prod.setupfile.spring.datasource.ssl.trust_store }}
          trust-store-type: JKS
          trust-store-cmks: ${DB_TRUSTSTORE_PASSWORD}
      jpa:
        show_sql: true
        open-in-view: false
        database-platform: {{ .Values.communitymanager.prod.setupfile.spring.jpa.database_platform }}
        properties:
          id:
            new_generator_mappings: true
        hibernate:
          naming:
            physical-strategy: com.pe.pcm.config.database.PhysicalNamingStrategy
      mail:
        host: {{ .Values.communitymanager.prod.setupfile.spring.mail.host }}
        port: {{ .Values.communitymanager.prod.setupfile.spring.mail.port }}
        username: {{ .Values.communitymanager.prod.setupfile.spring.mail.username }}
        cmks: ${SMTP_PASSWORD}
        from: {{ .Values.communitymanager.prod.setupfile.spring.mail.from }}
        app-contact-mail: {{ .Values.communitymanager.prod.setupfile.spring.mail.app_contact_mail }}
        mail-signature: {{ .Values.communitymanager.prod.setupfile.spring.mail.mail_signature }}
        properties:
          mail:
            smtp:
              auth: {{ .Values.communitymanager.prod.setupfile.spring.mail.properties.mail.smtp.auth }}
              starttls:
                enable: {{ .Values.communitymanager.prod.setupfile.spring.mail.properties.mail.smtp.starttls.enable }}
              ssl:
                trust: "*"
      thymeleaf:
        cache: true
    login:
      sm:
        enable: false
        param-name: SM_USER
      max-false-attempts: 5
      reset-false-attempts: 3
      user-cmks-expire: 30
    basic:
      auth:
        username: pemuser
        cmks: ${API_PASSWORD}
    jwt:
      secretkey: {{ .Values.communitymanager.prod.setupfile.jwt.secretkey }}
      session-expire: 60
    sterling-b2bi:
      core-bp:
        inbound: CM_MailBox_GET_RoutingRule_Inbound
        outbound: CM_MailBox_GET_RoutingRule_Outbound
      user:
        cmks: ${STERLING_SYSTEM_PASSPHRASE}
        cmks-validation: true
        cmks-validation-profile: CM_Profile
      b2bi-api:
        active: true
        auth-host:
          {{- range $key, $value := .Values.communitymanager.prod.setupfile.sterling_b2bi.b2bi_api.auth_host }}
          '{{ $value.name }}': {{ $value.value }}
          {{- end }}
        api:
          username: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.username }}
          cmks: ${STERLING_B2BAPI_PASSWORD}
          baseUrl: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.baseUrl }}/B2BAPIs/svc
        b2bi-sfg-api:
          active: true
          community-name: CM_PEMCommunity
        sfg-api:
          active: true
          api:
            username: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.username }}
            cmks: ${STERLING_SFGAPI_PASSWORD}
            baseUrl: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.baseUrl }}/sfgapis
        as2:
          active: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.b2bi_api.as2.active }}
        cd:
          net-map-name: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.b2bi_api.cd.net_map_name }}
          proxy:
            internal:
              server-host: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.b2bi_api.cd.proxy.internal.server_host }}
              server-port: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.b2bi_api.cd.proxy.internal.server_port }}
              secure-plus-option: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.b2bi_api.cd.proxy.internal.secure_plus_option }}
              ca-cert: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.b2bi_api.cd.proxy.internal.ca_cert }}
              system-certificate: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.b2bi_api.cd.proxy.internal.system_certificate }}
              security-protocol: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.b2bi_api.cd.proxy.internal.security_protocol }}
              cipher-suites: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.b2bi_api.cd.proxy.internal.cipher_suites }}
            external:
              server-host: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.b2bi_api.cd.proxy.external.server_host }}
              server-port: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.b2bi_api.cd.proxy.external.server_port }}
              secure-plus-option: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.b2bi_api.cd.proxy.external.secure_plus_option }}
              ca-cert: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.b2bi_api.cd.proxy.external.ca_cert }}
              system-certificate: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.b2bi_api.cd.proxy.external.system_certificate }}
              security-protocol: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.b2bi_api.cd.proxy.external.security_protocol }}
              cipher-suites: {{ .Values.communitymanager.prod.setupfile.sterling_b2bi.b2bi_api.cd.proxy.external.cipher_suites }}
    ssp:
      active: {{ .Values.communitymanager.prod.setupfile.ssp.active }}
      api:
        username: {{ .Values.communitymanager.prod.setupfile.ssp.api.username }}
        cmks: ${SSP_PASSWORD}
        baseUrl: {{ .Values.communitymanager.prod.setupfile.ssp.api.baseUrl }}
    adapters:
      ftpServerAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.ftpServerAdapterName }}
      ftpsClientAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.ftpsClientAdapterName }}
      ftpClientAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.ftpClientAdapterName }}
      ftpsServerAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.ftpsServerAdapterName }}
      sftpServerAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.sftpServerAdapterName }}
      sftpClientAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.sftpClientAdapterName }}
      as2ServerAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.as2ServerAdapterName }}
      as2ClientAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.as2ClientAdapterName }}
      as2HttpClientAdapter: {{ .Values.communitymanager.prod.setupfile.adapters.as2HttpClientAdapter }}
      cdClientAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.cdClientAdapterName }}
      httpServerAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.httpServerAdapterName }}
      httpsServerAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.httpsServerAdapterName }}
      mqAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.mqAdapterName }}
      wsServerAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.wsServerAdapterName }}
      fsAdapter: {{ .Values.communitymanager.prod.setupfile.adapters.fsAdapter }}
      sfgSftpClientAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.sfgSftpClientAdapterName }}
      sfgSftpServerAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.sfgSftpServerAdapterName }}
      sfgFtpClientAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.sfgFtpClientAdapterName }}
      sfgFtpServerAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.sfgFtpServerAdapterName }}
      sfgFtpsClientAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.sfgFtpsClientAdapterName }}
      sfgFtpsServerAdapterName: {{ .Values.communitymanager.prod.setupfile.adapters.sfgFtpsServerAdapterName }}
    alerts:
      email:
        enable:
          create: false
          update: false
          delete: false
          reports: false
    workFlow:
      duplicate:
        mft: true
        docHandling: true
    file-transfer:
      search:
        time-range: 30
    saml:
      sso-url: 
      idp:
        metadata:
        entity-id:
      idp-groups-role-mapper:
      default-role:
      jwt:
        secret-key: 
        session-expire: 60 #Minutes

      ssl:
        key-store: /opt/IBM/config/
        key-cmks: ${SAML_KEY_PASSWORD}
        store-cmks: ${SAML_KEYSTORE_PASSWORD}
        key-alias:
    pem:
      remote:
        server:
          pem-key: /opt/IBM/PCM/{{ .Values.communitymanager.prod.setupfile.pem.remote.server.pem_key }}
          base-directory:
            path: {{ .Values.communitymanager.prod.setupfile.pem.remote.server.base_directory.path }}
          session-timeout: {{ .Values.communitymanager.prod.setupfile.pem.remote.server.session_timeout }}
      datasource:
        url: {{ .Values.communitymanager.prod.setupfile.pem.datasource.url }}
        username: {{ .Values.communitymanager.prod.setupfile.pem.datasource.username }}
        cmks: ${PEM_DB_PASSWORD}
        driver-class-name: {{ .Values.communitymanager.prod.setupfile.pem.datasource.driver_class_name }}
      api-ws:
        active: {{ .Values.communitymanager.prod.setupfile.pem.api_ws.active }}
        base-url: {{ .Values.communitymanager.prod.setupfile.pem.api_ws.base_url }}
        username: {{ .Values.communitymanager.prod.setupfile.pem.api_ws.username }}
        cmks: ${PEM_API_PASSWORD}
    file:
      archive:
        scheduler:
          cron: "0 0 0 ? * * *"
          delete-files-job:
            active: false
            script-file-loc:
        pgp:
          private-key: {{ .Values.communitymanager.prod.setupfile.file.archive.pgp.private_key }}
          cmks: ${PGP_PASSPHRASE}
        aes:
          secret-key:
          salt:
    data:
      action: {{ .Values.communitymanager.prod.setupfile.ssomigration.data.action }}
      file-name: {{ .Values.communitymanager.prod.setupfile.ssomigration.data.file_name }}
    sso-ssp-seas:
      ssp:
        logout-endpoint: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.ssp.logout_endpoint }}
        user-header-name: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.ssp.user_header_name }}
        token-cookie-name: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.ssp.token_cookie_name }}
      seas:
        auth-profile: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.seas.auth_profile }}
        host: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.seas.host }}
        port: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.seas.port }}
        ssl:
          enabled: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.seas.ssl.enabled }}
          trust-store:
            name: /opt/IBM/config/{{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.seas.ssl.trust_store.name }}
            cmks: ${SEAS_TRUSTSTORE_PASSWORD}
            alias: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.seas.ssl.trust_store.alias }}
            type: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.seas.ssl.trust_store.type }}
          key-store:
            name: /opt/IBM/config/{{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.seas.ssl.key_store.name }}
            cmks: ${SEAS_KEYSTORE_PASSWORD}
            alias: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.seas.ssl.key_store.alias }}
            type: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.seas.ssl.key_store.type }}
      user-request:
        user:
          email: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.user_request.user.email }}
          role: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.user_request.user.role }}
          first-name: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.user_request.user.first_name }}
          last-name: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.user_request.user.last_name }}
          phone: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.user_request.user.phone }}
          external-id: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.user_request.user.external_id }}
          preferred-language: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.user_request.user.preferred_language }}
        user-roles:
          super_admin: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.user_request.user_roles.super_admin }}
          admin: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.user_request.user_roles.admin }}
          on_boarder: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.user_request.user_roles.on_boarder }}
          business_admin: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.user_request.user_roles.business_admin }}
          business_user: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.user_request.user_roles.business_user }}
          data_processor: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.user_request.user_roles.data_processor }}
          data_processor_restricted: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.user_request.user_roles.data_processor_restricted }}
          file_processor: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.user_request.user_roles.file_processor }}
          business_admin_dpr: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.user_request.user_roles.business_admin_dpr }}
        role-delimiter: {{ .Values.communitymanager.prod.setupfile.sso_ssp_seas.user_request.role_delimiter }}
    oauth2:
      enable: {{ .Values.communitymanager.prod.setupfile.oauth2.enable }}
      token-url: {{ .Values.communitymanager.prod.setupfile.oauth2.token_url }}
      grant-type: {{ .Values.communitymanager.prod.setupfile.oauth2.grant_type }}
      client-id: {{ .Values.communitymanager.prod.setupfile.oauth2.client_id }}
      client-secret: ${CLIENT_SECRET}
      username: {{ .Values.communitymanager.prod.setupfile.oauth2.username }}
      cmks: ${OAUTH2_CMKS}
      scope: {{ .Values.communitymanager.prod.setupfile.oauth2.scope }}
      resource:
      token:
       response-parser: {{ .Values.communitymanager.prod.setupfile.oauth2.token.response_parser }}
       prefix: {{ .Values.communitymanager.prod.setupfile.oauth2.token.prefix }}
       header: {{ .Values.communitymanager.prod.setupfile.oauth2.token.header }}
          
  jvmoptions: {{ .Values.communitymanager.prod.setupfile.jvmoptions }}
{{ end }}
{{ end }}
{{ end }}
